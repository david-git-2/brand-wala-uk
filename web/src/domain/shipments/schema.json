{
  "$id": "shipments",
  "collection": "shipments",
  "documentId": "{shipment_id}",
  "description": "Shipment header/config document. Item-level operational rows are stored in shipment_items.",
  "required": [
    "shipment_id",
    "name",
    "status",
    "cargo_cost_per_kg_gbp",
    "gbp_rate_product_bdt",
    "gbp_rate_cargo_bdt",
    "gbp_rate_avg_bdt",
    "order_date",
    "arrived_date",
    "total_value_gbp",
    "total_weight_g",
    "received_weight_g",
    "created_at",
    "updated_at"
  ],
  "properties": {
    "shipment_id": { "type": "string" },
    "name": { "type": "string" },
    "status": { "type": "string", "enum": ["draft", "in_transit", "received", "closed"] },
    "cargo_cost_per_kg_gbp": { "type": "number", "minimum": 0 },
    "gbp_rate_product_bdt": { "type": "number", "minimum": 0 },
    "gbp_rate_cargo_bdt": { "type": "number", "minimum": 0 },
    "gbp_rate_avg_bdt": { "type": "number", "minimum": 0 },
    "order_date": { "type": "timestamp" },
    "arrived_date": { "type": "timestamp" },
    "total_value_gbp": {
      "type": "number",
      "minimum": 0,
      "x-computed": true,
      "x-read-only": true,
      "x-derived-from": "shipment_items.total_value_gbp"
    },
    "total_weight_g": {
      "type": "number",
      "minimum": 0,
      "x-computed": true,
      "x-read-only": true,
      "x-derived-from": "shipment_items.unit_total_weight_g * shipment_items.needed_qty"
    },
    "received_weight_g": {
      "type": "number",
      "minimum": 0,
      "x-computed": true,
      "x-read-only": true,
      "x-derived-from": "shipment_items.received_weight_g"
    },
    "eta_date": { "type": "string" },
    "notes": { "type": "string" },
    "created_at": { "type": "timestamp" },
    "updated_at": { "type": "timestamp" }
  }
}
